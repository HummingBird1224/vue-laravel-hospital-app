import{a as v,d as de,aF as ue,A as S,B as me,U as fe,k as D,R as he,S as pe,aK as _e,r as m,o as w,l as C,w as i,f as o,h as g,q as j,aa as E,u as f,m as $,i as k,t as F,j as L,O as ge,x as M,e as H}from"./vendor.c29fa1eb.js";import{h as b,u as I,i as ye,e as Fe,c as ve,b as we}from"./main.02f9c92c.js";import{_ as be}from"./AstronautIcon.9a29c60e.js";import"./UserIndexDropdown.671f8071.js";import"./users.563d9224.js";const Be=(T=!1)=>{const A=T?window.pinia.defineStore:de,{global:c}=window.i18n;return A({id:"facilities",state:()=>({roles:[],facilities:[],totalFacilities:0,currentFacility:null,selectAllField:!1,selectedFacilities:[],customerList:[],userList:[],userData:{name:"",email:"",password:null,phone:null,companies:[]}}),actions:{resetFacilityData(){this.userData={name:"",email:"",password:null,phone:null,role:null,companies:[]}},fetchFacilities(a){return new Promise((n,l)=>{v.get("/api/v1/facilities",{params:a}).then(e=>{this.facilities=e.data.data,this.totalFacilities=e.data.meta.total,n(e)}).catch(e=>{b(e),l(e)})})},fetchFacility(a){return new Promise((n,l)=>{v.get(`/api/v1/facilities/${a}`).then(e=>{var r,h;this.userData=e.data.data,((h=(r=this.userData)==null?void 0:r.companies)==null?void 0:h.length)&&this.userData.companies.forEach((d,y)=>{this.userData.roles.forEach(u=>{u.scope===d.id&&(this.userData.companies[y].role=u.name)})}),n(e)}).catch(e=>{console.log(e),b(e),l(e)})})},fetchRoles(a){return new Promise((n,l)=>{v.get("/api/v1/roles").then(e=>{this.roles=e.data.data,n(e)}).catch(e=>{b(e),l(e)})})},addFacility(a){return new Promise((n,l)=>{v.post("/api/v1/facilities",a).then(e=>{this.facilities.push(e.data),I().showNotification({type:"success",message:c.t("facilities.created_message")}),n(e)}).catch(e=>{b(e),l(e)})})},updateFacility(a){return new Promise((n,l)=>{v.put(`/api/v1/facilities/${a.id}`,a).then(e=>{if(e){let h=this.facilities.findIndex(d=>d.id===e.data.data.id);this.facilities[h]=e.data.data}I().showNotification({type:"success",message:c.t("facilities.updated_message")}),n(e)}).catch(e=>{b(e),l(e)})})},deleteFacility(a){const n=I();return new Promise((l,e)=>{v.post("/api/v1/facilities/delete",{facilities:a.ids}).then(r=>{let h=this.facilities.findIndex(d=>d.id===a);this.facilities.splice(h,1),n.showNotification({type:"success",message:c.tc("facilities.deleted_message",1)}),l(r)}).catch(r=>{b(r),e(r)})})},deleteMultipleFacilities(){return new Promise((a,n)=>{v.post("/api/v1/facilities/delete",{facilities:this.selectedFacilities}).then(l=>{this.selectedFacilities.forEach(r=>{let h=this.facilities.findIndex(d=>d.id===r.id);this.facilities.splice(h,1)}),I().showNotification({type:"success",message:c.tc("facilities.deleted_message",2)}),a(l)}).catch(l=>{b(l),n(l)})})},searchFacilities(a){return new Promise((n,l)=>{v.get("/api/v1/search",{params:a}).then(e=>{this.userList=e.data.facilities.data,this.customerList=e.data.customers.data,n(e)}).catch(e=>{b(e),l(e)})})},setSelectAllState(a){this.selectAllField=a},selectFacility(a){this.selectedFacilities=a,this.selectedFacilities.length===this.facilities.length?this.selectAllField=!0:this.selectAllField=!1},selectAllFacilities(){if(this.selectedFacilities.length===this.facilities.length)this.selectedFacilities=[],this.selectAllField=!1;else{let a=this.facilities.map(n=>n.id);this.selectedFacilities=a,this.selectAllField=!0}}}})()},Se={class:"flex items-center justify-end space-x-5"},Ce={class:"relative table-container"},ke={class:"relative flex items-center justify-end h-5 border-gray-200 border-solid"},Ie={class:"flex text-sm font-medium cursor-pointer select-none text-primary-400"},xe={class:"absolute z-10 items-center left-6 top-2.5 select-none hidden"},De={class:"custom-control custom-checkbox"},$e={class:"flex items-center"},Ae={class:"flex items-center justify-center mr-3 overflow-hidden text-base font-semibold bg-gray-200 rounded-md w-9 h-9 text-primary-500"},Pe={key:0},Ne=["src"],Te={setup(T){I();const A=ye(),c=Be(),a=Fe(),n=ve(),l=we(),e=ue();let r=S(!1),h=S(!0);S(null),S("created_at"),S(!1);const{t:d}=me();let y=S(null),u=fe({name:""});const W=D(()=>[{key:"name",label:d("name"),thClass:"extra",tdClass:"font-medium text-gray-900"},{key:"address.phone",label:d("users.phone"),sortable:!1},{key:"created_at",label:d("added_on")},{key:"actions",tdClass:"text-right text-sm font-medium",sortable:!1}]);async function q(s){await l.setSelectedCompany(s),e.push("/admin/dashboard"),await globalStore.setIsAppLoaded(!1),await globalStore.bootstrap()}const z=D(()=>!c.totalFacilities&&!h.value),P=D({get:()=>c.selectedFacilities,set:s=>c.selectUser(s)}),N=D({get:()=>c.selectAllField,set:s=>c.setSelectAllState(s)});he(u,()=>{K()},{deep:!0}),pe(()=>{c.fetchFacilities()}),_e(()=>{c.selectAllField&&c.selectAllFacilities()});function K(){J()}function O(s){if(s)return s.split(" ")[0].charAt(0).toUpperCase()}function X(){n.openModal({title:d("company_switcher.new_company"),componentName:"CompanyModal",size:"sm"})}function J(){y.value&&y.value.refresh()}async function Q({page:s,filter:p,sort:B}){let V={display_name:u.name!==null?u.name:"",phone:u.phone!==null?u.phone:"",email:u.email!==null?u.email:"",orderByField:B.fieldName||"created_at",orderBy:B.order||"desc",page:s};h.value=!0;let _=await c.fetchFacilities(V);return h.value=!1,{data:_.data.data,pagination:{totalPages:_.data.meta.last_page,currentPage:s,totalCount:_.data.meta.total,limit:10}}}function R(){u.name="",u.email="",u.phone=null}function Y(){r.value&&R(),r.value=!r.value}function Z(){A.openDialog({title:d("general.are_you_sure"),message:d("users.confirm_delete",2),yesLabel:d("general.ok"),noLabel:d("general.cancel"),variant:"danger",size:"lg",hideNoButton:!1}).then(s=>{s&&c.deleteMultipleFacilities().then(p=>{p.data.success&&y.value&&y.value.refresh()})})}return(s,p)=>{const B=m("BaseBreadcrumbItem"),V=m("BaseBreadcrumb"),_=m("BaseIcon"),U=m("BaseButton"),ee=m("BasePageHeader"),te=m("BaseInput"),ae=m("BaseInputGroup"),se=m("BaseFilterWrapper"),ie=m("BaseEmptyPlaceholder"),le=m("BaseDropdownItem"),ne=m("BaseDropdown"),G=m("BaseCheckbox"),oe=m("router-link"),ce=m("BaseTable"),re=m("BasePage");return w(),C(re,null,{default:i(()=>[o(ee,{title:s.$t("facilities.title")},{actions:i(()=>[g("div",Se,[j(o(U,{variant:"primary-outline",onClick:Y},{right:i(t=>[f(r)?(w(),C(_,{key:1,name:"XIcon",class:$(t.class)},null,8,["class"])):(w(),C(_,{key:0,name:"FilterIcon",class:$(t.class)},null,8,["class"]))]),default:i(()=>[k(F(s.$t("general.filter"))+" ",1)]),_:1},512),[[E,f(c).totalFacilities]]),f(a).currentUser.is_owner?(w(),C(U,{key:0,onClick:X},{left:i(t=>[o(_,{name:"PlusIcon",class:$(t.class),"aria-hidden":"true"},null,8,["class"])]),default:i(()=>[k(" "+F(s.$t("facilities.add")),1)]),_:1})):L("",!0)])]),default:i(()=>[o(V,null,{default:i(()=>[o(B,{title:s.$t("general.home"),to:"dashboard"},null,8,["title"]),o(B,{title:s.$tc("facilities.title",2),to:"#",active:""},null,8,["title"])]),_:1})]),_:1},8,["title"]),o(se,{show:f(r),class:"mt-3",onClear:R},{default:i(()=>[o(ae,{label:s.$tc("users.name"),class:"flex-1 mt-2 mr-4"},{default:i(()=>[o(te,{modelValue:f(u).name,"onUpdate:modelValue":p[0]||(p[0]=t=>f(u).name=t),type:"text",name:"name",autocomplete:"off"},null,8,["modelValue"])]),_:1},8,["label"])]),_:1},8,["show"]),j(o(ie,{title:s.$t("users.no_users"),description:s.$t("users.list_of_users")},{actions:i(()=>[f(a).currentUser.is_owner?(w(),C(U,{key:0,variant:"primary-outline",onClick:p[1]||(p[1]=t=>s.$router.push("/admin/users/create"))},{left:i(t=>[o(_,{name:"PlusIcon",class:$(t.class)},null,8,["class"])]),default:i(()=>[k(" "+F(s.$t("users.add_user")),1)]),_:1})):L("",!0)]),default:i(()=>[o(be,{class:"mt-5 mb-4"})]),_:1},8,["title","description"]),[[E,f(z)]]),j(g("div",Ce,[g("div",ke,[f(c).selectedFacilities.length?(w(),C(ne,{key:0},{activator:i(()=>[g("span",Ie,[k(F(s.$t("general.actions"))+" ",1),o(_,{name:"ChevronDownIcon",class:"h-5"})])]),default:i(()=>[o(le,{onClick:Z},{default:i(()=>[o(_,{name:"TrashIcon",class:"h-5 mr-3 text-gray-600"}),k(" "+F(s.$t("general.delete")),1)]),_:1})]),_:1})):L("",!0)]),o(ce,{ref:(t,x)=>{x.table=t,M(y)?y.value=t:y=t},data:Q,columns:f(W),class:"mt-3"},ge({header:i(()=>[g("div",xe,[o(G,{modelValue:f(N),"onUpdate:modelValue":p[2]||(p[2]=t=>M(N)?N.value=t:null),variant:"primary",onChange:f(c).selectAllFacilities},null,8,["modelValue","onChange"])])]),"cell-status":i(({row:t})=>[g("div",De,[o(G,{id:t.data.id,modelValue:f(P),"onUpdate:modelValue":p[3]||(p[3]=x=>M(P)?P.value=x:null),value:t.data.id,variant:"primary"},null,8,["id","modelValue","value"])])]),"cell-name":i(({row:t})=>[o(oe,{to:"#",class:"font-medium text-primary-500",onClick:x=>q(t.data)},{default:i(()=>[g("div",$e,[g("span",Ae,[t.data.logo?(w(),H("img",{key:1,src:t.data.logo,alt:"Company logo",class:"w-full h-full object-contain"},null,8,Ne)):(w(),H("span",Pe,F(O(t.data.name)),1))]),k(" "+F(t.data.name),1)])]),_:2},1032,["onClick"])]),"cell-phone":i(({row:t})=>[g("span",null,F(t.data.phone?t.data.phone:"-"),1)]),"cell-created_at":i(({row:t})=>[g("span",null,F(t.data.formatted_created_at),1)]),_:2},[(f(a).currentUser.is_owner,void 0)]),1032,["columns"])],512),[[E,!f(z)]])]),_:1})}}};export{Te as default};
